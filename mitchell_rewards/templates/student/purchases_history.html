<!-- mitchell_rewards/templates/student/purchases_history.html -->
{% extends 'base.html' %} {% block title %}My Purchases - Mitchell Rewards{%
endblock %} {% block content %}
<main
  x-data="studentPurchasesHistory"
  class="student_purchases_history_main_content p-4 md:p-8"
>
  <h2
    class="student_purchases_history_page_title text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center"
  >
    My Purchases
  </h2>

  <!-- Custom Message Box Component - Controlled by appMessage Alpine.data -->
  <div
    x-data="appMessage"
    x-show="show"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 scale-90"
    x-transition:enter-end="opacity-100 scale-100"
    x-transition:leave="transition ease-in duration-300"
    x-transition:leave-start="opacity-100 scale-100"
    x-transition:leave-end="opacity-0 scale-90"
    class="fixed inset-x-0 top-0 left-0 right-0 z-[100] flex justify-center items-start p-4 pointer-events-none"
  >
    <div
      :class="{
            'bg-green-100 border border-green-400 text-green-700': type === 'success',
            'bg-red-100 border border-red-400 text-red-700': type === 'error'
        }"
      class="max-w-md w-full p-4 rounded-lg shadow-lg text-center pointer-events-auto mt-20"
    >
      <span x-text="message"></span>
    </div>
  </div>

  <!-- My Purchases Section (Table Layout) -->
  <section class="mb-10">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
        Purchased Items History
      </h3>
      <span class="text-lg font-bold text-gray-900 dark:text-white"
        >Total Spent: <span x-text="totalPurchasesPoints"></span> Points</span
      >
    </div>
    <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
      <table
        class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"
      >
        <thead
          class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400"
        >
          <tr>
            <th scope="col" class="px-6 py-3">Reward Item</th>
            <th scope="col" class="px-6 py-3 text-right">Points Spent</th>
            <th scope="col" class="px-6 py-3">Date Purchased</th>
          </tr>
        </thead>
        <tbody>
          <template x-for="purchase in purchases" :key="purchase.id">
            <tr
              class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600"
            >
              <td
                class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white"
                x-text="purchase.item"
              ></td>
              <td
                class="px-6 py-4 text-right text-lg font-bold text-gray-900 dark:text-white"
                x-text="'-' + purchase.points"
              ></td>
              {# Changed to black text #}
              <td class="px-6 py-4" x-text="purchase.date"></td>
            </tr>
          </template>
          <template x-if="purchases.length === 0">
            <tr>
              <td
                colspan="3"
                class="px-6 py-4 text-center text-gray-500 dark:text-gray-400"
              >
                No purchases made yet.
              </td>
            </tr>
          </template>
        </tbody>
      </table>
    </div>
  </section>
</main>
{% endblock %} {% block body_extra %}
<script>
  document.addEventListener("alpine:init", () => {
    Alpine.store("userRoles").currentRole = "student";
    document.getElementById("nav_user_name").innerText = "Student User";
    document.getElementById("nav_user_name_dropdown").innerText =
      "Student User";
    document.getElementById("nav_user_role").innerText = "Student";
  });
</script>
{% endblock %}
